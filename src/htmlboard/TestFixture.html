<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
                    "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <script src="lib/jquery.js"></script>
    <link rel="stylesheet" href="lib/qunit.css"
        type="text/css" media="screen" />
    <script type="text/javascript" src="lib/qunit.js"></script>
    <script type="text/javascript" src="htmlboard.js"></script>
    <script>

        $(document).ready(function () {

            var items = { 'ChessBoard': $('#chessboard') };

            QUnit.testStart = function (name) {
                $('#chessboard').html('');
            };

            module('Setup');

            test('The chess board has 64 squares', function () {
                $('#chessboard').setupBoard();
                equals($('#chessboard').find('div').length, 64, 'There are not 64 squares on the board.');
            });

            check_that_eight_squares_for_this_column_exist('A');
            check_that_eight_squares_for_this_column_exist('B');
            check_that_eight_squares_for_this_column_exist('C');
            check_that_eight_squares_for_this_column_exist('D');
            check_that_eight_squares_for_this_column_exist('E');
            check_that_eight_squares_for_this_column_exist('F');
            check_that_eight_squares_for_this_column_exist('G');
            check_that_eight_squares_for_this_column_exist('H');

            check_that_the_eight_rows_for_this_column_are_numbered_one_through_eight('A');
            check_that_the_eight_rows_for_this_column_are_numbered_one_through_eight('B');
            check_that_the_eight_rows_for_this_column_are_numbered_one_through_eight('C');
            check_that_the_eight_rows_for_this_column_are_numbered_one_through_eight('D');
            check_that_the_eight_rows_for_this_column_are_numbered_one_through_eight('E');
            check_that_the_eight_rows_for_this_column_are_numbered_one_through_eight('F');
            check_that_the_eight_rows_for_this_column_are_numbered_one_through_eight('G');
            check_that_the_eight_rows_for_this_column_are_numbered_one_through_eight('H');

            module('Load the board');

            test('Loading a white piece to a1 sets the white style to a1', function(){

                $('#chessboard').setupBoard();
                $('#chessboard').loadBoard([{"location" : "A1", "color": "white"}]);
    
                ok($($('#chessboard')).find('.A.1').hasClass('white'), 'The white style was not applied.');
		equals($('#chessboard').find('.white').length, 1, 'The white style was applied to the wrong squares.');
            });

	    test('Loading a black piece to a1 sets the black style to a1', function(){

                $('#chessboard').setupBoard();
                $('#chessboard').loadBoard([{"location" : "A1", "color": "black"}]);
      
                ok($($('#chessboard')).find('.A.1').hasClass('black'), 'The black style was not applied.');

		equals($('#chessboard').find('.black').length, 1, 'The black style was applied to the wrong squares.');

	    });

	    test('Loading a white piece to e4 sets the white style to e4', function(){
		$('#chessboard').setupBoard();
		$('#chessboard').loadBoard([{"location" : "E4", "color": "white"}]);

                ok($($('#chessboard')).find('.E.4').hasClass('white'), 'The white style was not applied.');

		equals($('#chessboard').find('.white').length, 1, 'The white style was applied to the wrong squares.');

	    }); 


	    test('Loading a white piece to c8 and a black piece to f7 will work', function(){
		$('#chessboard').setupBoard();
		$('#chessboard').loadBoard([{"location" : "C8", "color": "white"},
					    {"location" : "F7", "color": "black"}]);


                ok($($('#chessboard')).find('.C.8').hasClass('white'), 'The white style was not applied.');
		equals($('#chessboard').find('.white').length, 1, 'The white style was applied to the wrong squares.');

                ok($($('#chessboard')).find('.F.7').hasClass('black'), 'The black style was not applied.');
		equals($('#chessboard').find('.black').length, 1, 'The black style was applied to the wrong squares.');
	    }); 

	    check_that_this_piece_type_sets_the_style_to_a_square('pawn');
	    check_that_this_piece_type_sets_the_style_to_a_square('bishop');
	    check_that_this_piece_type_sets_the_style_to_a_square('knight');
	    check_that_this_piece_type_sets_the_style_to_a_square('rook');
	    check_that_this_piece_type_sets_the_style_to_a_square('queen');
	    check_that_this_piece_type_sets_the_style_to_a_square('king');

	    module('Piece movement');

	    test('Clicking on a piece will set a highlighted style to all available move squares', function(){
		$('#chessboard').setupBoard();
		$('#chessboard').setAvailableMoves([{"location": "A1", "availableMoves": ["A2", "F3"]}]);
		
		$('#chessboard').find('.A.1').click();
		
		ok($('#chessboard').find('.F.3').hasClass('highlighted'), "F3 was not set to be highlighted.");
		ok($('#chessboard').find('.A.2').hasClass('highlighted'), "A2 was not set to be highlighted.");
		equals($('#chessboard').find('.highlighted').length, 2, "Only F3 and A2 should be set to highlighted.");
	    });

	    test('Can differentiate between the squares for one piece and those for another', function(){
		$('#chessboard').setupBoard();
		$('#chessboard').setAvailableMoves([{"location": "H7", "availableMoves": ["A5"]},
						    {"location": "A1", "availableMoves": ["A2", "F3"]}]);
		
		$('#chessboard').find('.H.7').click();
		
		ok($('#chessboard').find('.A.5').hasClass('highlighted'), "A5 was not set to be highlighted.");
		equals($('#chessboard').find('.highlighted').length, 1, "Only A5 should be set to highlighted.");
	    });

	    function check_that_this_piece_type_sets_the_style_to_a_square(type){
		test('Loading a ' + type + ' to square a1 sets the ' + type + ' style to a1', function(){
		    $('#chessboard').setupBoard();
		    $('#chessboard').loadBoard([{"location" : "A1", "type": type}]);

		    ok($($('#chessboard')).find('.A.1').hasClass(type), 'The pawn style was not applied.');

		    equals($('#chessboard').find('.' + type).length, 1, 'The pawn style was applied to the wrong squares.');

		}); 
	    }


            function check_that_the_eight_rows_for_this_column_are_numbered_one_through_eight(column) {
                test('Column ' + column + ' has rows 1 through 8', function () {
                    $('#chessboard').setupBoard();
                    for(var index = 1; index < 8; index++)
                        equals($('#chessboard').find('.' + column + '.' + index).length, 1, 'Missing row ' + index + ' in column ' + column + '.');
                });

            }

            function check_that_eight_squares_for_this_column_exist(column) {
                test('The chess board contains 8 squares in column ' + column, function () {
                    $('#chessboard').setupBoard();
                    equals($('#chessboard').find('div.' + column).length, 8, 'There are not 8 ' + column + ' squares on the board.');
                });
            }
        });
    </script>
</head>
<body>
    <h1 id="qunit-header">
        QUnit example</h1>
    <h2 id="qunit-banner">
    </h2>
    <div id="qunit-testrunner-toolbar">
    </div>
    <h2 id="qunit-userAgent">
    </h2>
    <ol id="qunit-tests">
    </ol>
    <div id="qunit-fixture">
        <div id="chessboard">
        </div>
    </div>
</body>
</html>
