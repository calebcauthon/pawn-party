<script src="lib/jquery.144.js"></script>
<script src="lib/qunit.js"></script>
<link rel="stylesheet" href="css/qunit.css" />

<body>
  <h1 id="qunit-header">QUnit example</h1>
 <h2 id="qunit-banner"></h2>
 <div id="qunit-testrunner-toolbar"></div>
 <h2 id="qunit-userAgent"></h2>
 <ol id="qunit-tests"></ol>
 <div id="qunit-fixture">test markup, will be hidden</div>
</body>

<script type="text/javascript" src="lib/square.js"></script>
<script type="text/javascript" src="lib/piece.js"></script>
<script type="text/javascript">
$(document).ready(function() {
	var is_white = function(image_data) {
			if(image_data.data[0] == 0 &&
			image_data.data[1] == 0 &&
			image_data.data[2] == 0)
				return true;
			else
				return false;
		}
	var is_not_white = function(image_data) {
		return is_white(image_data) ? false : true;
	}
	test('square.draw() fills the square with its color', function() {
		var canvas = document.getElementById('canvas_element');
		var context = canvas.getContext('2d');
		
		var a_square = new square();
		var color = 'rgb(33,25,199)';
		
		a_square.color = color;
		a_square.set_context(context);
		a_square.width = 10;
		a_square.height = 10;
		a_square.draw(10,10);
		
		var pixel = context.getImageData(13,13,1,1);
		console.log(pixel);
		equals(pixel.data[0], 33);
		equals(pixel.data[1], 25);
		equals(pixel.data[2], 199);
		equals(is_not_white(pixel), true, "pixel should not be white");
	});
	test('square.draw() uses the width and height properties of itself', function() {
		var canvas = document.getElementById('canvas_element');
		var context = canvas.getContext('2d');
		var a_square = new square();
		a_square.set_context(context);
		
		var width = 10;
		var height = 99;
		var x = 33;
		var y = 22;
		a_square.width = width;
		a_square.height = height;
		
		a_square.draw(x, y);
		
		var pixel = context.getImageData(x, y, width-1, height-1);
		
		equals(is_not_white(pixel), true, 'pixel should not be white');		
	});
	test('square.draw() uses an ioc canvas context', function() {
		var this_canvas = document.getElementById('canvas_element');
		var this_context = this_canvas.getContext('2d');
		
		var that_canvas = document.getElementById('canvas_element_2');
		var that_context = that_canvas.getContext('2d');
		
		var this_square = new square();
		this_square.set_context(this_context);
		
		var that_square = new square();
		that_square.set_context(that_context);
		
		var x = 12;
		var y = 99;
		var width = 4;
		var height = 5;
		this_square.width = width;
		this_square.height = height;
		that_square.width = width;
		that_square.height = height;
		
		var this_pixel_before_draw = this_context.getImageData(x, y, width-1, height-1);
		var that_pixel_before_draw = that_context.getImageData(x, y, width-1, height-1);

		equals(is_white(this_pixel_before_draw), true, "this pixel is white before draw");
		equals(is_white(that_pixel_before_draw), true, "that pixel is white before draw");
		
		this_square.draw(x, y, 1, 1);		
		var this_pixel_after_this_draw = this_context.getImageData(x, y, width-1, height-1);
		var that_pixel_after_this_draw = that_context.getImageData(x, y, width-1, height-1);
		equals(is_not_white(this_pixel_after_this_draw), true, "this pixel is not white after this draw");
		equals(is_white(that_pixel_after_this_draw), true,  "that pixel is white after this draw");
		
		that_square.draw(x, y, 1, 1);
		var this_pixel_after_that_draw = this_context.getImageData(x, y, width-1, height-1);
		var that_pixel_after_that_draw = that_context.getImageData(x, y, width-1, height-1);
		equals(is_not_white(this_pixel_after_that_draw), true, "this pixel is not white after that draw");
		equals(is_not_white(that_pixel_after_that_draw), true, "that pixel is not white after that draw");
	});
	test('square.draw() throws an error if it doesnt have a context', function() {
		var a_square = new square();
		raises(a_square.draw, "expected an error, didnt get one");
	});
	test("square.draw() draws blank square if theres no piece", function() {
		// the square should start at the upper left corner, and be the width 
		// and height set in the square's properties
		var canvas = document.getElementById('canvas_element');
		var context = canvas.getContext('2d');
		
		var a_square = new square();		
		a_square.set_context(context);
		equals(a_square.has_piece(), false);
		
		var x = 4;
		var y = 34;
		var width = 5;
		var height = 5;
		a_square.width = width;
		a_square.height = height;
		var bottom_right_x = parseInt(x, 10) + parseInt(width, 10) - 1;
		var bottom_right_y = parseInt(y, 10) + parseInt(height, 10) - 1;
		
		

		var canvas = document.getElementById('canvas_element');
		var context = canvas.getContext('2d');
		
		var upper_left_corner_before_drawing = context.getImageData(x, y, 1, 1);
		var bottom_right_corner_before_drawing = context.getImageData(bottom_right_x, bottom_right_y, 1, 1);

		a_square.draw(x, y, width, height);
	
		var upper_left_corner_after_drawing = context.getImageData(x, y, 1, 1);
		var bottom_right_corner_after_drawing = context.getImageData(bottom_right_x, bottom_right_y, 1, 1);

		equals(is_white(upper_left_corner_before_drawing), true);
		equals(is_white(bottom_right_corner_before_drawing), true);
		equals(is_not_white(upper_left_corner_after_drawing), true);
		equals(is_not_white(bottom_right_corner_after_drawing), true);
	});
	test("square.set_piece() sets a chess piece", function() {
		var a_square = new square();
		var rook = new generic_chess_piece();
		
		equals(a_square.has_piece(), false);
		a_square.set_piece(rook);
		equals(a_square.has_piece(), true);
	});
	test("a square class exists", function() {
		var a_square = new square();
	});
	test("a basic test example", function() {
		ok( true, "this test is fine" );
		var value = "hello";
		equals( "hello", value, "We expect value to be hello" );
	});

});
</script>

<canvas id="canvas_element" height="1000" width="1000"></canvas>
<canvas id="canvas_element_2" height="1000" width="1000"></canvas>
